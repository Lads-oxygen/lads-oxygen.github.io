<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <title>LLM Evaluation</title> <div class=franklin-content ><div class=navbar-left > Ladislas Walewski <a href="https://github.com/lads-oxygen" target=_blank > <i class="fab fa-github" style="font-size:20px; margin-left:10px; color:var(--text-color);"></i> </a> <a href="https://www.linkedin.com/in/ladislas-walewski-232b032a4/" target=_blank > <i class="fab fa-linkedin" style="font-size:20px; margin-left:10px; color:var(--text-color);"></i> </a> </div> <div class=navbar-right > <a href="/">About</a> <a href="/blog/blog">Blog</a> <a href="/resources/resources">Resources</a> <label class=dark-mode-toggle  for=dark-mode-checkbox > <input type=checkbox  id=dark-mode-checkbox > <svg xmlns="http://www.w3.org/2000/svg" id=moon-svg > <path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z" /> </svg> <svg xmlns="http://www.w3.org/2000/svg" id=sun-svg  style="display:none;"> <path d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z" /> </svg> </label> </div> <div class=toc-container ><div class=toc ><div class=franklin-toc ><ol><li><a href="#large_language_model_llm_evaluation">Large Language Model &#40;LLM&#41; Evaluation</a><li><a href="#evaluation_methods">Evaluation Methods</a><li><a href="#human_vs_computational_vs_llm-based_evaluation">Human vs Computational vs LLM-Based Evaluation</a><li><a href="#comparison_of_evaluation_services">Comparison of Evaluation Services</a><li><a href="#conclusion">Conclusion</a><li><a href="#code_generation_further_reading">Code Generation &#40;Further Reading&#41;</a><li><a href="#references">References</a></ol></div></div></div> <div class=div ><h1 id=a_comparison_of_large_language_model_llm_evaluation_services ><a href="#a_comparison_of_large_language_model_llm_evaluation_services" class=header-anchor >A Comparison of Large Language Model &#40;LLM&#41; Evaluation Services</a></h1> <div class=date >September 2, 2024</div> <p>Before we begin discussing different LLM evaluation services, let&#39;s first review what LLM evaluation is and why it is important.</p> <h2 id=large_language_model_llm_evaluation ><a href="#large_language_model_llm_evaluation" class=header-anchor >Large Language Model &#40;LLM&#41; Evaluation</a></h2> <p>LLM evaluation refers to the process of gauging how well a model&#39;s outputs are aligned with human expectations. This involves assessing the model&#39;s performance across various tasks as well as ensuring that its interactions remain ethical and unbiased.</p> <p>As the deployment of LLMs has become more widespread, so has the need for rigorous and comprehensive evaluation methods. The increase in complexity and range of tasks that modern LLMs are used for has called for new evaluation methods, and integration of LLMs across various industries has also driven the need to assess their ethical implications. Of particular interest is the implementation of robust and systematic evaluation frameworks.</p> <p>In practice, we make use of:</p> <ul> <li><p>unit test cases - individual tests that examine how well a language model handles specific tasks e.g. assessing whether an LLM can generate a correct answer to a specific factual question.</p> <li><p>evaluation metrics - quantitative measures of an LLM&#39;s performance across a range of tasks e.g. verbosity.</p> </ul> <div class=figure ><img src="/assets/blog/LLM_Evaluation/LLM_Evaluation/eval_metric.svg" alt=""></div> <p>Next we consider the different types of scorers that we can use.</p> <h2 id=evaluation_methods ><a href="#evaluation_methods" class=header-anchor >Evaluation Methods</a></h2> <h3 id=human_evaluation ><a href="#human_evaluation" class=header-anchor >Human Evaluation</a></h3> <p>This is the most basic setup. Individuals manually judge LLM responses based on a set of criteria specific to each evaluation metric. In practice, this method often relies on the LLM application&#39;s end-users, instead of recruiting dedicated evaluators. The users provide feedback through mechanisms such as thumbs up/down buttons and binary choice buttons.</p> <h3 id=computation-based_metrics ><a href="#computation-based_metrics" class=header-anchor >Computation-Based Metrics</a></h3> <p>Computation-based metrics are quantitative measures for evaluating LLMs by comparing their outputs to predefined ground truths.</p> <ul> <li><p><strong>Lexicon-based metrics:</strong> Use maths to calculate the string similarities between LLM-generated results and ground truth, such as Exact Match and ROUGE.</p> <li><p><strong>Count-based metrics:</strong> Aggregate the number of rows that hit or miss certain ground-truth labels, such as F1-score, Accuracy, and Tool Name Match.</p> <li><p><strong>Embedding-based metrics:</strong> Calculate the distance/angle between the LLM-generated results and ground truth in the embedding space, reflecting their level of similarity.</p> </ul> <p>Computation-based metrics only capture surface level differences, as they cannot capture subtleties such as tone and style. Moreover, they may penalise small wording differences that convey the same meaning. To see this, let&#39;s consider the precision metric defined as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>Precision</mtext><mo>=</mo><mfrac><mtext>Number of common words between output and reference </mtext><mtext>Total number of words in output</mtext></mfrac></mrow><annotation encoding="application/x-tex"> \text{Precision} = \frac{\text{Number of common words between output and reference }}{\text{Total number of words in output}} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord text"><span class=mord >Precision</span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.2519em;vertical-align:-0.8804em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >Total number of words in output</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >Number of common words between output and reference </span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>against the following two sentences &#40;where reference is the ideal/expected output&#41;:</p> <p><strong>Reference Sentence:</strong> &quot;The cat sat on the mat.&quot;</p> <p><strong>Generated Output:</strong> &quot;The feline rested on the carpet.&quot;</p> <p>Despite the two sentences conveying the same meaning, the precision score would be low due to the lack of common words.</p> <h3 id=llm-based_evaluation ><a href="#llm-based_evaluation" class=header-anchor >LLM-Based Evaluation</a></h3> <p>This a relatively new evaluation technique, introduced in the LLM-as-a-Judge paper <sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup>. In this method, we use an LLM to evaluate the outputs of another LLM based on the same set of criteria as in human evaluation. The LLM judge used is typically a large generalist model or a smaller model fine-tuned for evaluation. The LLM judge can provide a score for each output, as well as a justification for the score.</p> <p><strong>Limitations:</strong></p> <ul> <li><p>Position bias - when comparing two models pair-wise, the first model is typically favoured.</p> <li><p>Self-enhancement bias - LLM judges may favour the answers generated by themselves.</p> <li><p>Verbosity bias - LLM judge favours longer, verbose responses, even if they are not as clear, high-quality, or accurate as shorter alternatives. As an oversimplification, we can see that this is because longer responses are more likely to contain the desired answer, as they contain more information.</p> </ul> <p>To counter these limitations, we can:</p> <ul> <li><p>Use point-wise evaluation <sup id="fnref:2"><a href="#fndef:2" class=fnref >[2]</a></sup>.</p> <li><p>Use various LLMs as judge or use an LLM fine-tuned for evaluation.</p> <li><p>Include a verbosity/concision metric to penalise overly verbose answers.</p> </ul> <p>Note that the length of the output, typically determines the main cost of the LLM call and it is also linearly correlated to the LLM&#39;s latency <sup id="fnref:3"><a href="#fndef:3" class=fnref >[3]</a></sup>. Hence, verbosity is actually one the most important metrics to evaluate.</p> <div class=figure ><img src="/assets/blog/LLM_Evaluation/LLM_Evaluation/point-wise_vs_pair-wise.svg" alt=""></div> <h2 id=human_vs_computational_vs_llm-based_evaluation ><a href="#human_vs_computational_vs_llm-based_evaluation" class=header-anchor >Human vs Computational vs LLM-Based Evaluation</a></h2> <p>Human evaluation is the most accurate and nuanced evaluation method. However, it is also the most expensive and time-consuming. Computational metrics are generally the fastest and cheapest, and LLM-based metrics strike a good middle ground between the two.</p> <p>As previously discussed, computational metrics are not as accurate or nuanced and they require a reference answer. By contrast, most LLM-based metrics are <strong>reference-free</strong>, besides a handful such as correctness or contextual recall/precision. In practice, this makes LLM-based metrics more suitable for live applications, as they can be used on dynamic datasets &#40;collection of test cases&#41; without the need to provide reference answers, which can be time-consuming and costly to obtain.</p> <p>Moreover, LLM-human agreement can achieve or even surpass the human-human agreement of around 80&#37; <sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup>, as for subjective tasks, LLMs can actually be more consistent than humans. The ability of LLM-based metrics to provide reasoning for their judgement is also a significant advantage. It seems like LLM-based metrics yield all the benefits of human evaluation, without the cost and time constraints.</p> <h2 id=comparison_of_evaluation_services ><a href="#comparison_of_evaluation_services" class=header-anchor >Comparison of Evaluation Services</a></h2> <p>We will consider the evaluation services provided by Amazon and Google&#39;s AI platforms, Amazon Bedrock and Vertex AI respectively, as well as an open source alternative, Deepeval, provided by Confident AI. The things we look for in an evaluation service are:</p> <ul> <li><p>Support for LLM-based metrics.</p> <li><p>The ability to define custom LLM-based metrics.</p> </ul> <div class=my-table ><table><tr><th align=right >Evaluation Service<th align=right >Deepeval<th align=right >Vertex AI<th align=right >Bedrock<tr><td align=right >Evaluation methods<td align=right ><ul><li>LLM-based metrics <li>Computational metrics <li>Human feedback </ul><td align=right ><ul><li>LLM-based metrics <li>Computational metrics </ul><td align=right ><ul><li>Computational metrics <li>Human evaluation </ul><tr><td align=right >The LLM used as a judge<td align=right ><ul><li>Use any model accessible through an API <li>Not fine-tuned for evaluation <ul><td align=right >Custom model used for evaluation, most likely based on gemini &#40;for example&#41; and fine-tuned for evaluation<td align=right >N/A<tr><td align=right >Custom LLM-based metric support<td align=right >Yes:<ul><li>Includes RAG metrics <li>Includes conversational metrics</ul><td align=right >Yes:<ul><li>Includes RAG metrics<li>Includes conversational metrics (new)</ul><td align=right >No<tr><td align=right >Custom LLM support<td align=right >Yes:<ul><li>online evaluations<li>Offline evaluations</ul><td align=right >Yes:<ul><li>Offline evaluations</ul><td align=right >No: <ul><li>Can only evaluate LLMs available on Bedrock</ul><tr><td align=right >Source availability<td align=right >Open source, except for visualisation dashboard &#40;Confident AI&#41;<td align=right >Closed source<td align=right >Closed source<tr><td align=right >Other caveats/advantages<td align=right ><ul><li>Most metrics are backed by research <sup id="fnref:4"><a href="#fndef:4" class=fnref >[4]</a></sup> </ul><td align=right ><ul><li>Non-english inputs have worse evaluation quality <li>Pointwise or pairwise evaluation <li>Most metrics require context parameter (unlike Deepeval) </ul><td align=right ></table></div> <p>Based on our previous discussion, we can see that Amazon Bedrock&#39;s evaluation service is the most primitive, as it lacks both LLM-based metrics as well the ability to evaluate LLMs that are not available on the platform. Vertex AI is more advanced, offering both of these features as well as supporting custom LLM-based metrics. Unfortunately, Google&#39;s implementation has higher friction when compared with Deepeval. More specifically, to define custom metrics in Vertex AI one has to provide the raw prompt, whereas in Deepeval one only needs to pass the metric&#39;s criteria to G-Eval <sup id="fnref:4"><a href="#fndef:4" class=fnref >[4]</a></sup>.</p> <p>In addition, Vertex AI only supports online evaluations for LLMs available on the Vertex AI platform, whereas Deepeval supports online evaluations for any LLM accessible through an API. Online evaluation refers to the process of evaluating models in real-time as they generate outputs, providing immediate feedback. This is particularly useful in applications requiring instant model adjustments, such as chatbots. In contrast, offline evaluation uses a historical dataset to assess model performance retrospectively, offering insights for batch processing or benchmarking.</p> <p>Another important difference between Vertex AI and Deepeval, is that Vertex AI uses a fine-tuned model for evaluation &#40;likely based on Gemini&#41;, while Deepeval uses any &#40;generalist&#41; model accessible through an API. In testing, both of these services are comparably accurate and consistent, however with Deepeval one has to be wary of using the same LLM for both generation and evaluation, as this can lead to the aforementioned self-enhancement bias.</p> <p>DeepEval, also has the advantage of being open source and having an active community that contributes to the project, ensuring it has all the latest features.</p> <h2 id=conclusion ><a href="#conclusion" class=header-anchor >Conclusion</a></h2> <p>In this article we&#39;ve reviewed LLM evaluation and compared the key differences between a couple evaluation services. We&#39;ve seen that LLM-based metrics are more suitable for live applications, and that DeepEval, has the most features and is the easiest to use. However, it is important to note that these products are quite new and constantly evolving, with Vertex AI&#39;s evaluation service still being in preview. By the time you read this article, the landscape may have changed.</p> <h2 id=code_generation_further_reading ><a href="#code_generation_further_reading" class=header-anchor >Code Generation &#40;Further Reading&#41;</a></h2> <p>Code generation is one of the most useful applications of LLMs. So naturally, evaluating the quality of generated code is of great interest. For the keen among you, I would recommend checking out this <a href="https://arxiv.org/abs/2107.03374">paper</a>, to see how we might evaluate functional correctness of generated code. Essentially we execute the generated code on a set of generated test cases in a sandbox environment, and check if the output matches the expected output. I would also recommend reading this <a href="https://github.com/microsoft/CodeT/tree/main/CodeT">paper</a>, which introduces a method for improving generated code. The idea is to generate multiple candidates and select the best one. In fact, this approach can also be used to improve the quality of generated text.</p> <h2 id=references ><a href="#references" class=header-anchor >References</a></h2> <div class=references ><table class=fndef  id="fndef:1"> <tr> <td class=fndef-backref ><a href="#fnref:1">[1]</a> <td class=fndef-content ><a href="https://example.com/llm-as-a-judge">LLM-as-a-Judge</a> </table> <table class=fndef  id="fndef:2"> <tr> <td class=fndef-backref ><a href="#fnref:2">[2]</a> <td class=fndef-content ><a href="https://www.taivo.ai/__llm-latency-is-linear-in-output-token-count/">Latency</a> </table> <table class=fndef  id="fndef:3"> <tr> <td class=fndef-backref ><a href="#fnref:3">[3]</a> <td class=fndef-content ><a href="https://arxiv.org/pdf/2406.12319">Point-wise vs Pair-wise</a> </table> <table class=fndef  id="fndef:4"> <tr> <td class=fndef-backref ><a href="#fnref:4">[4]</a> <td class=fndef-content ><a href="https://arxiv.org/abs/2303.16634">G-Eval</a> </table> </div> <div class=uncited-references ><p><a href="https://www.confident-ai.com/blog/why-llm-as-a-judge-is-the-best-llm-evaluation-method">Confident AI Blog</a></p> <p><a href="https://cloud.google.com/vertex-ai/docs/evaluation/introduction">Vertex AI Evaluation</a></p> <p><a href="https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-tasks.html">Bedrock Metrics</a></p></div></div> <div class=page-foot > Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div></div> <script src="/libs/dark-mode-toggle.js"></script>